version: 2

snapshots:
  - name: snapshot_polygon_stocks
    description: Raw daily OHLCV snapshot from Polygon.io for stocks (SCD2).
    tags: ["snapshot", "stocks", "polygon"]
    columns:
      - name: ticker
        description: Stock ticker symbol.
        tests:
          - not_null
      - name: polygon_trade_date
        description: Trading date (UTC).
        tests:
          - not_null
      - name: dbt_valid_from
        description: SCD2 validity start.
        tests:
          - not_null
      - name: dbt_scd_id
        description: SCD2 row identifier.
        tests:
          - not_null
    tests:
      - dbt_expectations.expect_compound_columns_to_be_unique:
          column_list: ["ticker", "polygon_trade_date", "dbt_valid_from"]

  - name: snapshot_polygon_options
    description: Raw daily OHLCV snapshot from Polygon.io for options (SCD2).
    tags: ["snapshot", "options", "polygon"]
    columns:
      - name: option_symbol
        description: OCC-formatted contract symbol.
        tests:
          - not_null
      - name: polygon_trade_date
        description: Trading date (UTC).
        tests:
          - not_null
      - name: dbt_valid_from
        description: SCD2 validity start.
        tests:
          - not_null
      - name: dbt_scd_id
        description: SCD2 row identifier.
        tests:
          - not_null
    tests:
      - dbt_expectations.expect_compound_columns_to_be_unique:
          column_list: ["option_symbol", "polygon_trade_date", "dbt_valid_from"]
